(function(s,A,i,t,m,E,v,M,T){"use strict";const w="https://api.deeplx.org/translate";var C={translate:async function(a){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",d=arguments.length>2?arguments[2]:void 0,g=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;try{if(g)return{source_lang:r,text:a};const e=await(await fetch(w,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:a,source_lang:r,target_lang:d})})).json();if(e.code!==200)throw Error(`Failed to translate text from DeepL: ${e.message}`);return{source_lang:r,text:e.data}}catch(e){throw console.log(e),Error("Failed to translate text from DeepL")}}};const _=i.findByProps("openLazy","hideActionSheet"),R=i.findByProps("ActionSheetRow")?.ActionSheetRow??M.Forms.FormRow,I=i.findByStoreName("MessageStore"),x=i.findByStoreName("ChannelStore"),N=t.stylesheet.createThemedStyleSheet({iconComponent:{width:24,height:24,tintColor:E.semanticColors.INTERACTIVE_NORMAL}});let c=[];function B(){return m.before("openLazy",_,function(a){let[r,d,g]=a;const e=g?.message;d!=="MessageLongPressActionSheet"||!e||r.then(function(b){const j=m.after("default",b,function(G,F){t.React.useEffect(function(){return function(){j()}},[]);const f=T.findInReactTree(F,function(n){return n?.[0]?.type?.name==="ButtonRow"});if(!f)return;const L=Math.max(f.findIndex(function(n){return n.props.message===t.i18n.Messages.MARK_UNREAD}),0),o=I.getMessage(e.channel_id,e.id);if(!o?.content&&!e.content)return;const h=o.id??e.id,O=o.content??e.content,p=c.find(function(n){return Object.keys(n)[0]===h},"cache object"),y=p?"Revert":"Translate",S=y==="Translate"?v.getAssetIDByName("ic_locale_24px"):v.getAssetIDByName("ic_highlight"),$=async function(){const n=u.target_lang,l=y==="Translate",U=await C.translate(o.content,null,n,!l);return t.FluxDispatcher.dispatch({type:"MESSAGE_UPDATE",message:{...o,content:`${l?U.text:p[h]} ${l?`\`[${n}]\``:""}`,guild_id:x.getChannel(o.channel_id).guild_id},log_edit:!1}),l?c.unshift({[h]:O}):c=c.filter(function(k){return k!==p},"cached data override"),_.hideActionSheet()};f.splice(L,0,t.React.createElement(R,{label:`${y} Message`,icon:t.React.createElement(R.Icon,{source:S,IconComponent:function(){return t.React.createElement(t.ReactNative.Image,{resizeMode:"cover",style:N.iconComponent,source:S})}}),onPress:$}))})})})}var D=[B];const u=A.storage;u.target_lang??="ko";var P={onUnload:function(){for(const a of D)a()}};return s.default=P,s.settings=u,Object.defineProperty(s,"__esModule",{value:!0}),s})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui,vendetta.ui.assets,vendetta.ui.components,vendetta.utils);
