(function(u,E,g,e,T,_,c,d,D,A,w,I){"use strict";const P="https://api.deeplx.org/translate";var C={translate:async function(n){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;try{if(s)return{source_lang:o,text:n};const t=await(await fetch(P,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:n,source_lang:o,target_lang:r})})).json();if(t.code!==200)throw Error(`Failed to translate text from DeepL: ${t.message}`);return{source_lang:o,text:t.data}}catch(t){throw Error(`Failed to translate text from DeepL: ${t}`)}}};const N=g.findByProps("openLazy","hideActionSheet"),L=g.findByProps("ActionSheetRow")?.ActionSheetRow??d.Forms.FormRow,$=g.findByStoreName("MessageStore"),B=g.findByStoreName("ChannelStore"),F=e.stylesheet.createThemedStyleSheet({iconComponent:{width:24,height:24,tintColor:_.semanticColors.INTERACTIVE_NORMAL}});let h=[];function M(){return T.before("openLazy",N,function(n){let[o,r,s]=n;const t=s?.message;r!=="MessageLongPressActionSheet"||!t||o.then(function(H){const J=T.after("default",H,function(te,Y){e.React.useEffect(function(){return function(){J()}},[]);const y=D.findInReactTree(Y,function(a){return a?.[0]?.type?.name==="ButtonRow"});if(!y)return;const Z=Math.max(y.findIndex(function(a){return a.props.message===e.i18n.Messages.MARK_UNREAD}),0),l=$.getMessage(t.channel_id,t.id);if(!l?.content&&!t.content)return;const p=l.id??t.id,q=l.content??t.content,v=h.find(function(a){return Object.keys(a)[0]===p},"cache object"),S=v?"Revert":"Translate",m=S==="Translate"?c.getAssetIDByName("ic_locale_24px"):c.getAssetIDByName("ic_highlight"),Q=async function(){try{const a=i.target_lang,f=S==="Translate",W=await C.translate(l.content,null,a,!f);e.FluxDispatcher.dispatch({type:"MESSAGE_UPDATE",message:{...l,content:`${f?W.text:v[p]} ${f?`\`[${a?.toLowerCase()}]\``:""}`,guild_id:B.getChannel(l.channel_id).guild_id},log_edit:!1}),f?h.unshift({[p]:q}):h=h.filter(function(X){return X!==v},"cached data override")}catch(a){w.showToast("Failed to translate message. Please check Debug Logs for more info.",c.getAssetIDByName("Small")),I.logger.error(a)}finally{return N.hideActionSheet()}};y.splice(Z,0,e.React.createElement(L,{label:`${S} Message`,icon:e.React.createElement(L.Icon,{source:m,IconComponent:function(){return e.React.createElement(e.ReactNative.Image,{resizeMode:"cover",style:F.iconComponent,source:m})}}),onPress:Q}))})})})}var O={bulgarian:"BG",czech:"CS",danish:"DA",german:"DE",greek:"EL",english:"EN",spanish:"ES",estonian:"ET",finnish:"FI",french:"FR",hungarian:"HU",indonesian:"ID",italian:"IT",japanese:"JA",korean:"KO",lithuanian:"LT",latvian:"LV",norwegian:"NO",dutch:"NL",polish:"PL",portuguese:"PT",romanian:"RO",russian:"RU",slovak:"SK",slovenian:"SL",swedish:"SV",turkish:"TR",ukrainian:"UK","chinese-simplified":"ZH"};const{FormRow:x}=d.Forms,{ScrollView:k}=e.ReactNative;function U(){A.useProxy(i);const[n,o]=e.React.useState("");return e.React.createElement(k,{style:{flex:1}},e.React.createElement(d.Search,{style:{padding:15},placeholder:"Search Language",onChangeText:function(r){o(r)}}),Object.entries(O).filter(function(r){let[s,t]=r;return s.includes(n)}).map(function(r){let[s,t]=r;return e.React.createElement(x,{label:s,trailing:function(){return e.React.createElement(x.Arrow,null)},onPress:function(){i.target_lang!=t&&(i.target_lang=t,w.showToast(`Saved ToLang to ${s}`,c.getAssetIDByName("check")))}})}))}const{ScrollView:j,Text:V}=e.ReactNative,{FormRow:R}=d.Forms,z=e.stylesheet.createThemedStyleSheet({subheaderText:{color:_.semanticColors.HEADER_SECONDARY,textAlign:"center",margin:10,marginBottom:50,letterSpacing:.25,fontFamily:e.constants.Fonts.PRIMARY_BOLD,fontSize:14}});function K(){const n=e.NavigationNative.useNavigation();return A.useProxy(i),e.React.createElement(j,null,e.React.createElement(R,{label:"Translate to",subLabel:i.target_lang?.toLowerCase(),leading:e.React.createElement(R.Icon,{source:c.getAssetIDByName("ic_activity_24px")}),trailing:function(){return e.React.createElement(R.Arrow,null)},onPress:function(){return n.push("VendettaCustomPage",{title:"Translate to",render:U})}}),e.React.createElement(V,{style:z.subheaderText,onPress:function(){return e.url.openURL("https://github.com/aeongdesu/vdplugins")}},`Build: (${E.manifest.hash.substring(0,7)})`))}const i=E.storage;i.target_lang??="EN";let b=[];var G={onLoad:function(){b.push(M())},onUnload:function(){for(const n of b)n()},settings:K};return u.default=G,u.settings=i,Object.defineProperty(u,"__esModule",{value:!0}),u})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui,vendetta.ui.assets,vendetta.ui.components,vendetta.utils,vendetta.storage,vendetta.ui.toasts,vendetta);
