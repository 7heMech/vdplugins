(function(s,E,i,t,m,M,_,T,w){"use strict";const C="https://api.deeplx.org/translate";var I={translate:async function(a){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",d=arguments.length>2?arguments[2]:void 0,g=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;try{if(g)return{source_lang:r,text:a};const e=await(await fetch(C,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:a,source_lang:r,target_lang:d})})).json();if(e.code!==200)throw Error(`Failed to translate text from DeepL: ${e.message}`);return{source_lang:r,text:e.data}}catch(e){throw console.log(e),Error("Failed to translate text from DeepL")}}};const v=i.findByProps("openLazy","hideActionSheet"),R=i.findByProps("ActionSheetRow")?.ActionSheetRow??T.Forms.FormRow,x=i.findByStoreName("MessageStore"),N=i.findByStoreName("ChannelStore"),B=t.stylesheet.createThemedStyleSheet({iconComponent:{width:24,height:24,tintColor:M.semanticColors.INTERACTIVE_NORMAL}});let c=[];function D(){return m.before("openLazy",v,function(a){let[r,d,g]=a;const e=g?.message;d!=="MessageLongPressActionSheet"||!e||r.then(function(P){const b=m.after("default",P,function(G,j){t.React.useEffect(function(){return function(){b()}},[]);const f=w.findInReactTree(j,function(n){return n?.[0]?.type?.name==="ButtonRow"});if(!f)return;const F=Math.max(f.findIndex(function(n){return n.props.message===t.i18n.Messages.MARK_UNREAD}),0),o=x.getMessage(e.channel_id,e.id);if(!o?.content&&!e.content)return;const h=o.id??e.id,O=o.content??e.content,p=c.find(function(n){return Object.keys(n)[0]===h},"cache object"),y=p?"Revert":"Translate",A=y==="Translate"?_.getAssetIDByName("ic_locale_24px"):_.getAssetIDByName("ic_highlight"),$=async function(){const n=l.target_lang,u=y==="Translate",U=await I.translate(o.content,null,n,!u);return t.FluxDispatcher.dispatch({type:"MESSAGE_UPDATE",message:{...o,content:`${u?U.text:p[h]} ${u?`\`[${n}]\``:""}`,guild_id:N.getChannel(o.channel_id).guild_id},log_edit:!1}),u?c.unshift({[h]:O}):c=c.filter(function(k){return k!==p},"cached data override"),v.hideActionSheet()};f.splice(F,0,t.React.createElement(R,{label:`${y} Message`,icon:t.React.createElement(R.Icon,{source:A,IconComponent:function(){return t.React.createElement(t.ReactNative.Image,{resizeMode:"cover",style:B.iconComponent,source:A})}}),onPress:$}))})})})}const l=E.storage;l.target_lang??="ko";let S=[];var L={onLoad:function(){S.push(D())},onUnload:function(){for(const a of S)a()}};return s.default=L,s.settings=l,Object.defineProperty(s,"__esModule",{value:!0}),s})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui,vendetta.ui.assets,vendetta.ui.components,vendetta.utils);
