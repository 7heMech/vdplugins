(function(c,p,$,I,s,k,m){"use strict";const N=$.findByProps("sendBotMessage"),r=function(n,e){return N.sendBotMessage(n,e)},o=function(n){return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},g=function(n,e){return n.find(function(t){return t.name==e})?.value};let a=I.storage;const _={beatmap_official:/https?:\/\/osu.ppy.sh\/beatmapsets\/[0-9]+\#(osu|taiko|fruits|mania)\/([0-9]+)/,beatmap_old:/https?:\/\/(osu|old).ppy.sh\/b\/([0-9]+)/,beatmap_alternate:/https?:\/\/osu.ppy.sh\/beatmaps\/([0-9]+)/,beatmap_old_alternate:/https?:\/\/(osu|old).ppy.sh\/p\/beatmap\?b=([0-9]+)/},v=/https?:\/\/(osu|old).ppy.sh\/(u|users)\/([^\s]+)/,R=async function(){if(a.accessData?.token&&a.accessData?.expires_in>Date.now())return a.accessData.token;const n=await fetch("https://osu.ppy.sh/oauth/token",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({client_id:a.clientID,client_secret:a.clientSecret,grant_type:"client_credentials",scope:"public"})});if(!n.ok)return!0;const{access_token:e,expires_in:t}=await n.json();return a.accessData={token:e,expires_in:t*1e3+Date.now()},e},l=async function(n){return await fetch(n,{method:"GET",headers:{"content-type":"application/json",accept:"application/json",authorization:`Bearer ${await R()}`}}).then(function(e){return e.json()})},T=async function(n){if(isNaN(parseFloat(n)))for(const t in _){const i=n.match(_[t]);i&&(n=i[i.length-1])}const e=await l(`https://osu.ppy.sh/api/v2/beatmaps/${n}`);if(e.id)return{id:e.id,setid:e.beatmapset_id,title:e.beatmapset.title,artist:e.beatmapset.artist,status:e.beatmapset.status,version:e.version,diffrating:e.difficulty_rating,bpm:e.bpm}},b=async function(n){if(!n&&!a.user)return;if(n||(n=a.user),isNaN(parseFloat(n))){const h=n.match(v);h&&(n=h[h.length-1])}const e=await l(`https://osu.ppy.sh/api/v2/users/${n}`);if(!e.id)return;let t=e.statistics.global_rank,i=e.rank_highest,f=e.statistics.country_rank;return t==null&&(t=0),i==null&&(i={rank:0,updated_at:""}),f==null&&(f=0),{active:e.is_active,bot:e.is_bot,deleted:e.is_deleted,online:e.is_online,supporter:e.is_supporter,country_code:e.country_code,username:e.username,id:e.id,join_date:+new Date(e.join_date)/1e3,accuracy:e.statistics.hit_accuracy.toFixed(2),level:e.statistics.level,playcount:o(e.statistics.play_count),playtime:o(Math.floor(e.statistics.play_time/3600)),rank:o(t),rank_highest:i,grades:e.statistics.grade_counts,country_rank:o(f),pp:e.statistics.pp}},w=async function(n,e){if(!n&&!a.user)return;if(n||(n=a.user),isNaN(parseFloat(n))){const i=n.match(v);i&&(n=i[i.length-1])}const t=await b(n);return t?await l(`https://osu.ppy.sh/api/v2/users/${t.id}/scores/recent?include_fails=1&mode=osu&limit=5&offset=1`):void 0};var x=p.registerCommand({name:"osu-profile",displayName:"osu-profile",description:"Display statistics of a user",displayDescription:"Display statistics of a user",options:[{name:"profile",displayName:"profile",description:"Specify a username, ID, or URL",displayDescription:"Specify a username, ID, or URL",required:!1,type:3},{name:"send",displayName:"send",description:"Whether to send the result",displayDescription:"Whether to send the result",required:!1,type:5}],applicationId:"",inputType:1,type:1,execute:async function(n,e){if(!a.clientID||isNaN(parseFloat(a.clientID))||!a.clientSecret)return r(e.channel.id,"Please set apiv2 configuration in plugin settings.");const t=await b(g(n,"profile"));if(!t)return r(e.channel.id,"Invalid User.");let i;return t.bot||t.deleted||!t.active?i=[`> ${t.username}: https://osu.ppy.sh/users/${t.id} ${t.deleted?"*Deleted User*":t.bot?"*Bot*":t.active?"":"*Inactive User*"}`]:i=[`> ${t.username}: ${t.pp}pp (#${t.rank} ${t.country_code}${t.country_rank})`,`    <https://osu.ppy.sh/users/${t.id}>
`,`> Highest rank: \`#${o(t.rank_highest.rank)}\` on <t:${+new Date(t.rank_highest.updated_at)/1e3}:D>`,`> Accuracy: \`${t.accuracy}%\` \u2022 Level: \`${t.level.current}.${t.level.progress}%\``,`> Playcount: \`${t.playcount}\` (\`${t.playtime} hrs\`)`,`> Ranks: **SSH** \`${t.grades.ssh}\` **SS** \`${t.grades.ss}\` **SH** \`${t.grades.sh}\` **S** \`${t.grades.s}\` **A** \`${t.grades.a}\``,`> Joined osu! <t:${t.join_date}:f>`],g(n,"send")===!0?{content:i.join(`
`)}:r(e.channel.id,i.join(`
`))}}),U=p.registerCommand({name:"osu-beatmap",displayName:"osu-beatmap",description:"Sends an info message about the specified beatmap",displayDescription:"Sends an info message about the specified beatmap",options:[{name:"beatmap",displayName:"beatmap",description:"Specify a beatmap URL or ID",displayDescription:"Specify a beatmap URL or ID",required:!0,type:3}],applicationId:"",inputType:1,type:1,execute:async function(n,e){if(!a.clientID||isNaN(parseFloat(a.clientID))||!a.clientSecret)return r(e.channel.id,"Please set apiv2 configuration in plugin settings.");const t=await T(n[0].value);return t?r(e.channel.id,`${t.status} | ${t.title} - ${t.version}`):r(e.channel.id,"Invalid Beatmap.")}}),E=p.registerCommand({name:"osu-recent",displayName:"osu-recent",description:"Get the recent score(s) of a user",displayDescription:"Get the recent score(s) of a user",options:[{name:"user",displayName:"user",description:"Specify a username, ID, or URL",displayDescription:"Specify a username, ID, or URL",required:!1,type:3}],applicationId:"",inputType:1,type:1,execute:async function(n,e){if(!a.clientID||isNaN(parseFloat(a.clientID))||!a.clientSecret)return r(e.channel.id,"Please set apiv2 configuration in plugin settings.");const t=await w(n[0].value);return t?r(e.channel.id,JSON.stringify(t)):r(e.channel.id,"Invalid User / No recent scores")}});const D=[x,U,E],{ScrollView:L,Text:u}=s.ReactNative,{FormSection:S,FormInput:d,FormDivider:F}=k.Forms,y=s.stylesheet.createThemedStyleSheet({subText:{fontSize:14,marginHorizontal:15,color:m.semanticColors.TEXT_MUTED,fontFamily:s.constants.Fonts.PRIMARY_NORMAL},textLink:{color:m.semanticColors.TEXT_LINK}});function j(){return s.React.createElement(L,{style:{flex:1,marginHorizontal:3,marginVertical:3}},s.React.createElement(S,{title:"apiv2 configuration",titleStyleType:"no_border"},s.React.createElement(u,{style:y.subText},"You will need to register an OAuth application on your ",s.React.createElement(u,{style:y.textLink,onPress:function(){return s.url.openURL("https://osu.ppy.sh/home/account/edit#new-oauth-application")}},"account settings page"),"."),s.React.createElement(u,{style:y.subText},"Application Callback URL is not required!"),s.React.createElement(d,{title:"Client ID",value:a.clientID,placeholder:"00000",onChangeText:function(n){return a.clientID=n}}),s.React.createElement(d,{title:"Client Secret",value:a.clientSecret,placeholder:"asdfghjkl",onChangeText:function(n){return a.clientSecret=n}})),s.React.createElement(F,null),s.React.createElement(S,{title:"default user",titleStyleType:"no_border"},s.React.createElement(d,{title:"User",value:a.user,placeholder:"peppy",onChangeText:function(n){return a.user=n}})))}var C={onLoad:function(){return D},onUnload:function(){for(const n of D)n()},settings:j};return c.default=C,Object.defineProperty(c,"__esModule",{value:!0}),c})({},vendetta.commands,vendetta.metro,vendetta.plugin,vendetta.metro.common,vendetta.ui.components,vendetta.ui);
