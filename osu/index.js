(function(p,u,S,k,i,I,g){"use strict";const R=S.findByProps("sendBotMessage"),r=function(n,t){return R.sendBotMessage(n,t)},c=function(n){return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},l=function(n,t){return n.find(function(e){return e.name==t})?.value};let a=k.storage;const _={beatmap_official:/https?:\/\/osu.ppy.sh\/beatmapsets\/[0-9]+\#(osu|taiko|fruits|mania)\/([0-9]+)/,beatmap_old:/https?:\/\/(osu|old).ppy.sh\/b\/([0-9]+)/,beatmap_alternate:/https?:\/\/osu.ppy.sh\/beatmaps\/([0-9]+)/,beatmap_old_alternate:/https?:\/\/(osu|old).ppy.sh\/p\/beatmap\?b=([0-9]+)/},$=/https?:\/\/(osu|old).ppy.sh\/(u|users)\/([^\s]+)/,N=async function(){if(a.accessData?.token&&a.accessData?.expires_in>Date.now())return a.accessData.token;const n=await fetch("https://osu.ppy.sh/oauth/token",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({client_id:a.clientID,client_secret:a.clientSecret,grant_type:"client_credentials",scope:"public"})});if(!n.ok)return!0;const{access_token:t,expires_in:e}=await n.json();return a.accessData={token:t,expires_in:e*1e3+Date.now()},t},d=async function(n){return await fetch(n,{method:"GET",headers:{"content-type":"application/json",accept:"application/json",authorization:`Bearer ${await N()}`}}).then(function(t){return t.json()})},T=async function(n){if(isNaN(parseFloat(n)))for(const e in _){const s=n.match(_[e]);s&&(n=s[s.length-1])}const t=await d(`https://osu.ppy.sh/api/v2/beatmaps/${n}`);if(t.id)return{id:t.id,setid:t.beatmapset_id,title:t.beatmapset.title,artist:t.beatmapset.artist,status:t.beatmapset.status,version:t.version,diffrating:t.difficulty_rating,bpm:t.bpm}},b=async function(n){if(!n&&!a.user)return;if(n||(n=a.user),isNaN(parseFloat(n))){const m=n.match($);m&&(n=m[m.length-1])}const t=await d(`https://osu.ppy.sh/api/v2/users/${n}`);if(!t.id)return;let e=t.statistics.global_rank,s=t.rank_highest,o=t.statistics.country_rank;return e==null&&(e=0),s==null&&(s={rank:0,updated_at:""}),o==null&&(o=0),{active:t.is_active,bot:t.is_bot,deleted:t.is_deleted,online:t.is_online,supporter:t.is_supporter,country_code:t.country_code,username:t.username,id:t.id,join_date:+new Date(t.join_date)/1e3,accuracy:t.statistics.hit_accuracy.toFixed(2),level:t.statistics.level,playcount:c(t.statistics.play_count),playtime:c(Math.floor(t.statistics.play_time/3600)),rank:c(e),rank_highest:s,grades:t.statistics.grade_counts,country_rank:c(o),pp:t.statistics.pp}},w=async function(n,t){if(!n&&!a.user)return;if(n||(n=a.user),isNaN(parseFloat(n))){const o=n.match($);o&&(n=o[o.length-1])}const e=await b(n);if(!e)return;const s=await d(`https://osu.ppy.sh/api/v2/users/${e.id}/scores/recent?include_fails=1&mode=osu&limit=5&offset=1`);if(s.length!==0)return s};var x=u.registerCommand({name:"osu-profile",displayName:"osu-profile",description:"Display statistics of a user",displayDescription:"Display statistics of a user",options:[{name:"user",displayName:"user",description:"Specify a username, ID, or URL",displayDescription:"Specify a username, ID, or URL",required:!1,type:3},{name:"send",displayName:"send",description:"Whether to send the result",displayDescription:"Whether to send the result",required:!1,type:5}],applicationId:"",inputType:1,type:1,execute:async function(n,t){if(!a.clientID||isNaN(parseFloat(a.clientID))||!a.clientSecret)return r(t.channel.id,"Please set apiv2 configuration in plugin settings.");const e=await b(l(n,"user"));if(!e)return r(t.channel.id,"Invalid User.");let s;return e.bot||e.deleted||!e.active?s=[`> ${e.username}: https://osu.ppy.sh/users/${e.id} ${e.deleted?"*Deleted User*":e.bot?"*Bot*":e.active?"":"*Inactive User*"}`]:s=[`> ${e.username}: ${e.pp}pp (#${e.rank} ${e.country_code}${e.country_rank})`,`    <https://osu.ppy.sh/users/${e.id}>
`,`> Rank Peak: \`#${c(e.rank_highest.rank)}\` on <t:${+new Date(e.rank_highest.updated_at)/1e3}:D>`,`> Accuracy: \`${e.accuracy}%\` \u2022 Level: \`${e.level.current}.${e.level.progress}%\``,`> Playcount: \`${e.playcount}\` (\`${e.playtime} hrs\`)`,`> Ranks: **SSH** \`${e.grades.ssh}\` **SS** \`${e.grades.ss}\` **SH** \`${e.grades.sh}\` **S** \`${e.grades.s}\` **A** \`${e.grades.a}\``,`> Joined osu! <t:${e.join_date}:f>`],l(n,"send")===!0?{content:s.join(`
`)}:r(t.channel.id,s.join(`
`))}}),U=u.registerCommand({name:"osu-beatmap",displayName:"osu-beatmap",description:"Sends an info message about the specified beatmap",displayDescription:"Sends an info message about the specified beatmap",options:[{name:"beatmap",displayName:"beatmap",description:"Specify a beatmap URL or ID",displayDescription:"Specify a beatmap URL or ID",required:!0,type:3}],applicationId:"",inputType:1,type:1,execute:async function(n,t){if(!a.clientID||isNaN(parseFloat(a.clientID))||!a.clientSecret)return r(t.channel.id,"Please set apiv2 configuration in plugin settings.");const e=await T(n[0].value);return e?r(t.channel.id,`${e.status} | ${e.title} - ${e.version}`):r(t.channel.id,"Invalid Beatmap.")}}),j=u.registerCommand({name:"osu-recent",displayName:"osu-recent",description:"Get the recent score(s) of a user",displayDescription:"Get the recent score(s) of a user",options:[{name:"user",displayName:"user",description:"Specify a username, ID, or URL",displayDescription:"Specify a username, ID, or URL",required:!1,type:3}],applicationId:"",inputType:1,type:1,execute:async function(n,t){if(!a.clientID||isNaN(parseFloat(a.clientID))||!a.clientSecret)return r(t.channel.id,"Please set apiv2 configuration in plugin settings.");const e=await w(l(n,"user"));if(!e)return r(t.channel.id,"Invalid User / No recent scores");const s=[`> ${e[0].user.country_code} | ${e[0].user.username}`,`    <${e[0].passed?`https://osu.ppy.sh/scores/osu/${e[0].id}`:e[0].beatmap.url}>`,`> ${e[0].beatmapset.artist} - ${e[0].beatmapset.title} [${e[0].beatmap.version}] [${e[0].beatmap.difficulty_rating}]`,`> **_${e[0].rank}_   ${e[0].mods.length>0?`+${e[0].mods.join("")} `:""}${c(e[0].score)}   (${Number(e[0].accuracy*100).toFixed(2)}%)   <t:${+new Date(e[0].created_at)/1e3}:R>**`,`> [${e[0].max_combo}x]`,`> {${e[0].statistics.count_300}/${e[0].statistics.count_100}/${e[0].statistics.count_50}/${e[0].statistics.count_miss}}`];return r(t.channel.id,s.join(`
`))}});const v=[x,U,j],{ScrollView:E,Text:y}=i.ReactNative,{FormSection:D,FormInput:h,FormDivider:F}=I.Forms,f=i.stylesheet.createThemedStyleSheet({subText:{fontSize:14,marginHorizontal:15,color:g.semanticColors.TEXT_MUTED,fontFamily:i.constants.Fonts.PRIMARY_NORMAL},textLink:{color:g.semanticColors.TEXT_LINK}});function L(){return i.React.createElement(E,{style:{flex:1,marginHorizontal:3,marginVertical:3}},i.React.createElement(D,{title:"apiv2 configuration",titleStyleType:"no_border"},i.React.createElement(y,{style:f.subText},"You will need to register an OAuth application on your ",i.React.createElement(y,{style:f.textLink,onPress:function(){return i.url.openURL("https://osu.ppy.sh/home/account/edit#new-oauth-application")}},"account settings page"),"."),i.React.createElement(y,{style:f.subText},"Application Callback URL is not required!"),i.React.createElement(h,{title:"Client ID",value:a.clientID,placeholder:"00000",onChangeText:function(n){return a.clientID=n}}),i.React.createElement(h,{title:"Client Secret",value:a.clientSecret,placeholder:"asdfghjkl",onChangeText:function(n){return a.clientSecret=n}})),i.React.createElement(F,null),i.React.createElement(D,{title:"default user",titleStyleType:"no_border"},i.React.createElement(h,{title:"User",value:a.user,placeholder:"peppy",onChangeText:function(n){return a.user=n}})))}var C={onLoad:function(){return v},onUnload:function(){for(const n of v)n()},settings:L};return p.default=C,Object.defineProperty(p,"__esModule",{value:!0}),p})({},vendetta.commands,vendetta.metro,vendetta.plugin,vendetta.metro.common,vendetta.ui.components,vendetta.ui);
