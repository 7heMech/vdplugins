(function(l,d,y,_,i,v){"use strict";const b=y.findByProps("sendBotMessage"),o=function(a,e){return b.sendBotMessage(a,e)},c=function(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")};let n=_.storage;const D=y.findByProps("Messages"),h={beatmap_official:/https?:\/\/osu.ppy.sh\/beatmapsets\/[0-9]+\#(osu|taiko|fruits|mania)\/([0-9]+)/,beatmap_old:/https?:\/\/(osu|old).ppy.sh\/b\/([0-9]+)/,beatmap_alternate:/https?:\/\/osu.ppy.sh\/beatmaps\/([0-9]+)/,beatmap_old_alternate:/https?:\/\/(osu|old).ppy.sh\/p\/beatmap\?b=([0-9]+)/},$=/https?:\/\/(osu|old).ppy.sh\/(u|users)\/([^\s]+)/,S=async function(){if(n.accessData?.token&&n.accessData?.expires_in>Date.now())return n.accessData.token;const a=await fetch("https://osu.ppy.sh/oauth/token",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({client_id:n.clientID,client_secret:n.clientSecret,grant_type:"client_credentials",scope:"public"})});if(!a.ok)throw D.receieveMessage({content:"Failed to get access token. Did you enter the apiv2 configuration correctly?"});const{access_token:e,expires_in:s}=await a.json();return n.accessData={token:e,expires_in:s*1e3+Date.now()},e},f=async function(a){return await fetch(a,{method:"GET",headers:{"content-type":"application/json",accept:"application/json",authorization:`Bearer ${await S()}`}}).then(function(e){return e.json()})},k=async function(a){if(isNaN(parseFloat(a)))for(const s in h){const t=a.match(h[s]);t&&(a=t[t.length-1])}const e=await f(`https://osu.ppy.sh/api/v2/beatmaps/${a}`);if(e.id)return{id:e.id,setid:e.beatmapset_id,title:e.beatmapset.title,artist:e.beatmapset.artist,status:e.beatmapset.status,version:e.version,diffrating:e.difficulty_rating,bpm:e.bpm}},I=async function(a){if(!n.user)return;if(a||(a=n.user),isNaN(parseFloat(a))){const p=a.match($);p&&(a=p[p.length-1])}const e=await f(`https://osu.ppy.sh/api/v2/users/${a}`);if(!e.id)return;let s=e.statistics.global_rank,t=e.rank_highest,r=e.statistics.country_rank;return s==null&&(s=0),t==null&&(t={rank:0,updated_at:""}),r==null&&(r=0),{active:e.is_active,bot:e.is_bot,deleted:e.is_deleted,online:e.is_online,supporter:e.is_supporter,country_code:e.country_code,username:e.username,id:e.id,join_date:+new Date(e.join_date)/1e3,accuracy:e.statistics.hit_accuracy.toFixed(2),level:e.statistics.level,playcount:c(e.statistics.play_count),playtime:c(Math.floor(e.statistics.play_time/3600)),rank:c(s),rank_highest:t,grades:e.statistics.grade_counts,country_rank:c(r),pp:e.statistics.pp}};var N=d.registerCommand({name:"osu-profile",displayName:"osu-profile",description:"Display statistics of a user",displayDescription:"Display statistics of a user",options:[{name:"profile",displayName:"profile",description:"Specify a username, ID, or URL of the player",displayDescription:"Specify a username, ID, or URL of the player",required:!1,type:3},{name:"send",displayName:"send",description:"Whether to send the result",displayDescription:"Whether to send the result",required:!1,type:5}],applicationId:"",inputType:1,type:1,execute:async function(a,e){const s=function(p){return a.find(function(U){return U.name==p})?.value};if(!n.clientID||isNaN(parseFloat(n.clientID))||!n.clientSecret)return o(e.channel.id,"Please set apiv2 configuration in plugin settings.");const t=await I(s("profile"));if(!t)return o(e.channel.id,"Invalid User.");let r;return t.bot||t.deleted||!t.active?r=[`> ${t.username}: https://osu.ppy.sh/users/${t.id} ${t.deleted?"*Deleted User*":t.bot?"*Bot*":t.active?"":"*Inactive User*"}`]:r=[`> ${t.username}: ${t.pp}pp (#${t.rank} ${t.country_code}${t.country_rank})`,`    <https://osu.ppy.sh/users/${t.id}>
`,`> Highest rank: \`#${c(t.rank_highest.rank)}\` on <t:${+new Date(t.rank_highest.updated_at)/1e3}:D>`,`> Accuracy: \`${t.accuracy}%\` \u2022 Level: \`${t.level.current}.${t.level.progress}%\``,`> Playcount: \`${t.playcount}\` (\`${t.playtime} hrs\`)`,`> Ranks: **SSH** \`${t.grades.ssh}\` **SS** \`${t.grades.ss}\` **SH** \`${t.grades.sh}\` **S** \`${t.grades.s}\` **A** \`${t.grades.a}\``,`> Joined osu! <t:${t.join_date}:f>`],s("send")===!0?{content:r.join(`
`)}:o(e.channel.id,r.join(`
`))}}),w=d.registerCommand({name:"osu-beatmap",displayName:"osu-beatmap",description:"Sends an info message about the specified beatmap",displayDescription:"Sends an info message about the specified beatmap",options:[{name:"beatmap",displayName:"beatmap",description:"Specify a beatmap URL or ID",displayDescription:"Specify a beatmap URL or ID",required:!0,type:3}],applicationId:"",inputType:1,type:1,execute:async function(a,e){if(!n.clientID||isNaN(parseFloat(n.clientID))||!n.clientSecret)return o(e.channel.id,"Please set apiv2 configuration in plugin settings.");const s=await k(a[0].value);return s?o(e.channel.id,`${s.status} | ${s.title} - ${s.version}`):o(e.channel.id,"Invalid Beatmap.")}});const m=[N,w],{ScrollView:R}=i.ReactNative,{FormSection:g,FormInput:u,FormDivider:j}=v.Forms;function B(){return i.React.createElement(R,{style:{flex:1}},i.React.createElement(g,{title:"apiv2 configuration",titleStyleType:"no_border"},i.React.createElement(u,{title:"Client ID",value:n.clientID,placeholder:"00000",onChangeText:function(a){return n.clientID=a}}),i.React.createElement(u,{title:"Client Secret",value:n.clientSecret,placeholder:"asdfghjkl",onChangeText:function(a){return n.clientSecret=a}})),i.React.createElement(j,null),i.React.createElement(g,{title:"default user",titleStyleType:"no_border"},i.React.createElement(u,{title:"User",value:n.user,placeholder:"peppy",onChangeText:function(a){return n.user=a}})))}var F={onLoad:function(){return m},onUnload:function(){for(const a of m)a()},settings:B};return l.default=F,Object.defineProperty(l,"__esModule",{value:!0}),l})({},vendetta.commands,vendetta.metro,vendetta.plugin,vendetta.metro.common,vendetta.ui.components);
