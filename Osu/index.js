(function(o,c,f,m,s,y){"use strict";const h=f.findByProps("sendBotMessage"),i=function(e,t){return h.sendBotMessage(e,t)};let a=m.storage;const p={beatmap_official:/https?:\/\/osu.ppy.sh\/beatmapsets\/[0-9]+\#(osu|taiko|fruits|mania)\/([0-9]+)/,beatmap_old:/https?:\/\/(osu|old).ppy.sh\/b\/([0-9]+)/,beatmap_alternate:/https?:\/\/osu.ppy.sh\/beatmaps\/([0-9]+)/,beatmap_old_alternate:/https?:\/\/(osu|old).ppy.sh\/p\/beatmap\?b=([0-9]+)/},b=/https?:\/\/(osu|old).ppy.sh\/(u|users)\/([^\s]+)/,g=async function(){if(a.accessData?.token&&a.accessData?.expires_in>Date.now())return a.accessData.token;const{access_token:e,expires_in:t}=await fetch("https://osu.ppy.sh/oauth/token",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({client_id:a.clientID,client_secret:a.clientSecret,grant_type:"client_credentials",scope:"public"})}).then(function(n){return n.json()});return a.accessData={token:e,expires_in:t*1e3+Date.now()},e},l=async function(e){return await fetch(e,{method:"GET",headers:{"content-type":"application/json",authorization:`Bearer ${await g()}`}}).then(function(t){return t.json()})},v=async function(e){if(isNaN(parseFloat(e)))for(const n in p){const r=e.match(p[n]);r&&(e=r[r.length-1])}const t=await l(`https://osu.ppy.sh/api/v2/beatmaps/${e}`);if(t.id)return{id:t.id,setid:t.beatmapset_id,title:t.beatmapset.title,artist:t.beatmapset.artist,status:t.beatmapset.status,version:t.version,diffrating:t.difficulty_rating,bpm:t.bpm}},D=async function(e){if(isNaN(parseFloat(e))){const n=e.match(b);n&&(e=n[n.length-1])}const t=await l(`https://osu.ppy.sh/api/v2/users/${e}`);if(console.log(t),!!t.id)return{country_code:t.country_code,username:t.username,id:t.id,rank:t.statistics.global_rank,country_rank:t.statistics.country_rank,pp:t.statistics.pp}};var _=c.registerCommand({name:"osu-profile",displayName:"osu-profile",description:"Display statistics of a user",displayDescription:"Display statistics of a user",options:[{name:"profile",displayName:"profile",description:"Specify a username, ID, or URL of the player",displayDescription:"Specify a username, ID, or URL of the player",required:!1,type:3}],applicationId:"",inputType:1,type:1,execute:async function(e,t){if(!a.clientID||isNaN(parseFloat(a.clientID))||!a.clientSecret)return i(t.channel.id,"Please set apiv2 configuration in plugin settings.");const n=await D(e?.[0].value);return n?i(t.channel.id,`${n.username} - ${n.pp}pp`):i(t.channel.id,"Invalid User.")}}),I=c.registerCommand({name:"osu-beatmap",displayName:"osu-beatmap",description:"Sends an info message about the specified beatmap",displayDescription:"Sends an info message about the specified beatmap",options:[{name:"beatmap",displayName:"beatmap",description:"Specify a beatmap URL or ID",displayDescription:"Specify a beatmap URL or ID",required:!0,type:3}],applicationId:"",inputType:1,type:1,execute:async function(e,t){if(!a.clientID||isNaN(parseFloat(a.clientID))||!a.clientSecret)return i(t.channel.id,"Please set apiv2 configuration in plugin settings.");const n=await v(e[0].value);return n?i(t.channel.id,`${n.status} | ${n.title} - ${n.version}`):i(t.channel.id,"Invalid Beatmap.")}});const u=[_,I],{ScrollView:S}=s.ReactNative,{FormSection:N,FormInput:d}=y.Forms;function k(){return s.React.createElement(S,{style:{flex:1}},s.React.createElement(N,{title:"apiv2 configuration",titleStyleType:"no_border"},s.React.createElement(d,{title:"Client ID",value:a.clientID,placeholder:"00000",onChangeText:function(e){return a.clientID=e}}),s.React.createElement(d,{title:"Client Secret",value:a.clientSecret,placeholder:"asdfghjkl",onChangeText:function(e){return a.clientSecret=e}})))}var w={onLoad:function(){return u},onUnload:function(){for(const e of u)e()},settings:k};return o.default=w,Object.defineProperty(o,"__esModule",{value:!0}),o})({},vendetta.commands,vendetta.metro,vendetta.plugin,vendetta.metro.common,vendetta.ui.components);
