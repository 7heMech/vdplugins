(function(l,u,D,$,s,S,f){"use strict";const I=D.findByProps("sendBotMessage"),r=function(a,e){return I.sendBotMessage(a,e)},c=function(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")};let n=$.storage;const m={beatmap_official:/https?:\/\/osu.ppy.sh\/beatmapsets\/[0-9]+\#(osu|taiko|fruits|mania)\/([0-9]+)/,beatmap_old:/https?:\/\/(osu|old).ppy.sh\/b\/([0-9]+)/,beatmap_alternate:/https?:\/\/osu.ppy.sh\/beatmaps\/([0-9]+)/,beatmap_old_alternate:/https?:\/\/(osu|old).ppy.sh\/p\/beatmap\?b=([0-9]+)/},k=/https?:\/\/(osu|old).ppy.sh\/(u|users)\/([^\s]+)/,R=async function(){if(n.accessData?.token&&n.accessData?.expires_in>Date.now())return n.accessData.token;const a=await fetch("https://osu.ppy.sh/oauth/token",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({client_id:n.clientID,client_secret:n.clientSecret,grant_type:"client_credentials",scope:"public"})});if(!a.ok)return!0;const{access_token:e,expires_in:i}=await a.json();return n.accessData={token:e,expires_in:i*1e3+Date.now()},e},g=async function(a){return await fetch(a,{method:"GET",headers:{"content-type":"application/json",accept:"application/json",authorization:`Bearer ${await R()}`}}).then(function(e){return e.json()})},_=async function(a){if(isNaN(parseFloat(a)))for(const i in m){const t=a.match(m[i]);t&&(a=t[t.length-1])}const e=await g(`https://osu.ppy.sh/api/v2/beatmaps/${a}`);if(e.id)return{id:e.id,setid:e.beatmapset_id,title:e.beatmapset.title,artist:e.beatmapset.artist,status:e.beatmapset.status,version:e.version,diffrating:e.difficulty_rating,bpm:e.bpm}},N=async function(a){if(!n.user)return;if(a||(a=n.user),isNaN(parseFloat(a))){const p=a.match(k);p&&(a=p[p.length-1])}const e=await g(`https://osu.ppy.sh/api/v2/users/${a}`);if(!e.id)return;let i=e.statistics.global_rank,t=e.rank_highest,o=e.statistics.country_rank;return i==null&&(i=0),t==null&&(t={rank:0,updated_at:""}),o==null&&(o=0),{active:e.is_active,bot:e.is_bot,deleted:e.is_deleted,online:e.is_online,supporter:e.is_supporter,country_code:e.country_code,username:e.username,id:e.id,join_date:+new Date(e.join_date)/1e3,accuracy:e.statistics.hit_accuracy.toFixed(2),level:e.statistics.level,playcount:c(e.statistics.play_count),playtime:c(Math.floor(e.statistics.play_time/3600)),rank:c(i),rank_highest:t,grades:e.statistics.grade_counts,country_rank:c(o),pp:e.statistics.pp}};var T=u.registerCommand({name:"osu-profile",displayName:"osu-profile",description:"Display statistics of a user",displayDescription:"Display statistics of a user",options:[{name:"profile",displayName:"profile",description:"Specify a username, ID, or URL",displayDescription:"Specify a username, ID, or URL",required:!1,type:3},{name:"send",displayName:"send",description:"Whether to send the result",displayDescription:"Whether to send the result",required:!1,type:5}],applicationId:"",inputType:1,type:1,execute:async function(a,e){const i=function(p){return a.find(function(F){return F.name==p})?.value};if(!n.clientID||isNaN(parseFloat(n.clientID))||!n.clientSecret)return r(e.channel.id,"Please set apiv2 configuration in plugin settings.");const t=await N(i("profile"));if(!t)return r(e.channel.id,"Invalid User.");let o;return t.bot||t.deleted||!t.active?o=[`> ${t.username}: https://osu.ppy.sh/users/${t.id} ${t.deleted?"*Deleted User*":t.bot?"*Bot*":t.active?"":"*Inactive User*"}`]:o=[`> ${t.username}: ${t.pp}pp (#${t.rank} ${t.country_code}${t.country_rank})`,`    <https://osu.ppy.sh/users/${t.id}>
`,`> Highest rank: \`#${c(t.rank_highest.rank)}\` on <t:${+new Date(t.rank_highest.updated_at)/1e3}:D>`,`> Accuracy: \`${t.accuracy}%\` \u2022 Level: \`${t.level.current}.${t.level.progress}%\``,`> Playcount: \`${t.playcount}\` (\`${t.playtime} hrs\`)`,`> Ranks: **SSH** \`${t.grades.ssh}\` **SS** \`${t.grades.ss}\` **SH** \`${t.grades.sh}\` **S** \`${t.grades.s}\` **A** \`${t.grades.a}\``,`> Joined osu! <t:${t.join_date}:f>`],i("send")===!0?{content:o.join(`
`)}:r(e.channel.id,o.join(`
`))}}),w=u.registerCommand({name:"osu-beatmap",displayName:"osu-beatmap",description:"Sends an info message about the specified beatmap",displayDescription:"Sends an info message about the specified beatmap",options:[{name:"beatmap",displayName:"beatmap",description:"Specify a beatmap URL or ID",displayDescription:"Specify a beatmap URL or ID",required:!0,type:3}],applicationId:"",inputType:1,type:1,execute:async function(a,e){if(!n.clientID||isNaN(parseFloat(n.clientID))||!n.clientSecret)return r(e.channel.id,"Please set apiv2 configuration in plugin settings.");const i=await _(a[0].value);return i?r(e.channel.id,`${i.status} | ${i.title} - ${i.version}`):r(e.channel.id,"Invalid Beatmap.")}}),x=u.registerCommand({name:"osu-recent",displayName:"osu-recent",description:"Get the recent score(s) of a user",displayDescription:"Get the recent score(s) of a user",options:[{name:"user",displayName:"user",description:"Specify a username, ID, or URL",displayDescription:"Specify a username, ID, or URL",required:!1,type:3}],applicationId:"",inputType:1,type:1,execute:async function(a,e){if(!n.clientID||isNaN(parseFloat(n.clientID))||!n.clientSecret)return r(e.channel.id,"Please set apiv2 configuration in plugin settings.");const i=await _(a[0].value);return i?r(e.channel.id,`${i.status} | ${i.title} - ${i.version}`):r(e.channel.id,"Invalid Beatmap.")}});const v=[T,w,x],{ScrollView:U,Text:d}=s.ReactNative,{FormSection:b,FormInput:y,FormDivider:E}=S.Forms,h=s.stylesheet.createThemedStyleSheet({subText:{fontSize:14,marginHorizontal:15,color:f.semanticColors.TEXT_MUTED,fontFamily:s.constants.Fonts.PRIMARY_NORMAL},textLink:{color:f.semanticColors.TEXT_LINK}});function L(){return s.React.createElement(U,{style:{flex:1,marginHorizontal:3,marginVertical:3}},s.React.createElement(b,{title:"apiv2 configuration",titleStyleType:"no_border"},s.React.createElement(d,{style:h.subText},"You will need to register an OAuth application on your ",s.React.createElement(d,{style:h.textLink,onPress:function(){return s.url.openURL("https://osu.ppy.sh/home/account/edit#new-oauth-application")}},"account settings page"),"."),s.React.createElement(d,{style:h.subText},"Application Callback URL is not required!"),s.React.createElement(y,{title:"Client ID",value:n.clientID,placeholder:"00000",onChangeText:function(a){return n.clientID=a}}),s.React.createElement(y,{title:"Client Secret",value:n.clientSecret,placeholder:"asdfghjkl",onChangeText:function(a){return n.clientSecret=a}})),s.React.createElement(E,null),s.React.createElement(b,{title:"default user",titleStyleType:"no_border"},s.React.createElement(y,{title:"User",value:n.user,placeholder:"peppy",onChangeText:function(a){return n.user=a}})))}var j={onLoad:function(){return v},onUnload:function(){for(const a of v)a()},settings:L};return l.default=j,Object.defineProperty(l,"__esModule",{value:!0}),l})({},vendetta.commands,vendetta.metro,vendetta.plugin,vendetta.metro.common,vendetta.ui.components,vendetta.ui);
